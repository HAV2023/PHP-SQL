LecciÃ³n 7 â€” Eliminar usuario (eliminar.php)

â¸»

Parte A â€” CÃ³digo limpio

<?php
require_once "conexion.php";

/* 1) Validar parÃ¡metro id */
$id = isset($_GET["id"]) ? (int)$_GET["id"] : 0;
if ($id <= 0) {
    die("ID invÃ¡lido.");
}

/* 2) Verificar existencia previa */
$sql_sel = "SELECT id FROM usuarios WHERE id = ?";
$sentencia_sel = $conexion->prepare($sql_sel);
if (!$sentencia_sel) { die("Error al preparar la consulta: " . $conexion->error); }
$sentencia_sel->bind_param("i", $id);
$sentencia_sel->execute();
$resultado = $sentencia_sel->get_result();
if (!$resultado || $resultado->num_rows !== 1) {
    die("Usuario no encontrado.");
}
$sentencia_sel->close();

/* 3) Ejecutar eliminaciÃ³n */
$sql_del = "DELETE FROM usuarios WHERE id = ?";
$sentencia_del = $conexion->prepare($sql_del);
if (!$sentencia_del) { die("Error al preparar la eliminaciÃ³n: " . $conexion->error); }
$sentencia_del->bind_param("i", $id);

if ($sentencia_del->execute()) {
    $sentencia_del->close();
    header("Location: privado.php");
    exit;
} else {
    $sentencia_del->close();
    die("Error al eliminar: " . $conexion->error);
}


â¸»

Parte B â€” ExplicaciÃ³n lÃ­nea por lÃ­nea

1) ValidaciÃ³n del identificador
	â€¢	$id = isset($_GET["id"]) ? (int)$_GET["id"] : 0;
Recupera el valor de id enviado en la URL. Lo convierte a entero. Si no existe, usa 0.
	â€¢	if ($id <= 0) { die("ID invÃ¡lido."); }
Evita ejecutar la lÃ³gica si el valor no es positivo. die() detiene el script y muestra el texto.

2) VerificaciÃ³n de existencia
	â€¢	$sql_sel = "SELECT id FROM usuarios WHERE id = ?";
Consulta SQL con un marcador ? para asegurar que el id existe en la tabla.
	â€¢	$conexion->prepare($sql_sel);
Prepara la sentencia en MySQL, segura contra inyecciÃ³n.
	â€¢	$sentencia_sel->bind_param("i", $id);
Asocia el parÃ¡metro id como entero ("i").
	â€¢	$sentencia_sel->execute();
Ejecuta la sentencia.
	â€¢	$resultado = $sentencia_sel->get_result();
Obtiene el resultado en forma de conjunto de filas.
	â€¢	if (!$resultado || $resultado->num_rows !== 1)
Si no encuentra exactamente un registro, corta ejecuciÃ³n con â€œUsuario no encontrado.â€.
	â€¢	$sentencia_sel->close();
Libera la sentencia usada para la verificaciÃ³n.

3) EliminaciÃ³n
	â€¢	$sql_del = "DELETE FROM usuarios WHERE id = ?";
Sentencia SQL para borrar un registro por id.
	â€¢	$sentencia_del = $conexion->prepare($sql_del);
Prepara la sentencia de eliminaciÃ³n.
	â€¢	$sentencia_del->bind_param("i", $id);
Enlaza el valor entero al marcador ?.
	â€¢	if ($sentencia_del->execute()) { ... } else { ... }
Intenta ejecutar la eliminaciÃ³n:
	â€¢	Ã‰xito â†’ cierra sentencia, redirige al listado privado.php.
	â€¢	Falla â†’ cierra sentencia y muestra error detallado.

â¸»

ğŸ” Pruebas sugeridas
	1.	Desde privado.php, clic en Eliminar en un usuario existente.
â El registro debe desaparecer y volver al listado.
	2.	Probar eliminar.php?id=99999.
â Mensaje: â€œUsuario no encontrado.â€
	3.	Probar eliminar.php?id=texto.
â Mensaje: â€œID invÃ¡lido.â€
	4.	Verificar en phpMyAdmin que el registro realmente fue borrado.

â¸»
