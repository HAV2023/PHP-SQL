üìò Lecci√≥n 5 ‚Äî P√°gina privada y cierre de sesi√≥n

Parte A ‚Äî C√≥digo limpio (privado.php)

<?php
require_once "conexion.php";

if (!isset($_SESSION["usuario_id"])) {
    header("Location: iniciar_sesion.php");
    exit;
}

$nombre_usuario = $_SESSION["usuario_nombre"];
$correo_usuario = $_SESSION["usuario_correo"];

$consulta = $conexion->query(
    "SELECT id, nombre, correo, creado_en
     FROM usuarios
     ORDER BY id DESC"
);
?>
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Zona privada</title>
  <link rel="stylesheet" href="estilo.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <h1>Zona privada</h1>

  <p>Bienvenido, <strong><?= htmlspecialchars($nombre_usuario) ?></strong>
     (<?= htmlspecialchars($correo_usuario) ?>)</p>

  <nav>
    <a href="registrar.php">Crear usuario</a> |
    <a href="privado.php">Inicio</a> |
    <a href="salir.php">Cerrar sesi√≥n</a>
  </nav>

  <hr>

  <h2>Usuarios registrados</h2>

  <?php if ($consulta && $consulta->num_rows > 0): ?>
    <table border="1" cellpadding="6">
      <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Correo</th>
        <th>Creado</th>
        <th>Acciones</th>
      </tr>
      <?php while ($fila = $consulta->fetch_assoc()): ?>
        <tr>
          <td><?= (int)$fila["id"] ?></td>
          <td><?= htmlspecialchars($fila["nombre"]) ?></td>
          <td><?= htmlspecialchars($fila["correo"]) ?></td>
          <td><?= htmlspecialchars($fila["creado_en"]) ?></td>
          <td>
            <a href="editar.php?id=<?= (int)$fila['id'] ?>">Editar</a> |
            <a href="eliminar.php?id=<?= (int)$fila['id'] ?>"
               onclick="return confirm('¬øSeguro de eliminar?');">Eliminar</a>
          </td>
        </tr>
      <?php endwhile; ?>
    </table>
  <?php else: ?>
    <p>No hay usuarios registrados.</p>
  <?php endif; ?>
</body>
</html>

Parte B ‚Äî Explicaci√≥n l√≠nea por l√≠nea (privado.php)
	‚Ä¢	require_once "conexion.php";
Incluye conexi√≥n y sesi√≥n iniciada para poder leer $_SESSION.
	‚Ä¢	if (!isset($_SESSION["usuario_id"])) { ... }
Verifica existencia de la variable de sesi√≥n que identifica al usuario autenticado. El operador ! niega la condici√≥n; si no existe, no hay sesi√≥n v√°lida.
	‚Ä¢	header("Location: iniciar_sesion.php"); exit;
Env√≠a cabecera HTTP de redirecci√≥n al formulario de login y detiene el script.
	‚Ä¢	$nombre_usuario = $_SESSION["usuario_nombre"];
Copia a variable local el nombre guardado en sesi√≥n.
	‚Ä¢	$correo_usuario = $_SESSION["usuario_correo"];
Copia a variable local el correo guardado en sesi√≥n.
	‚Ä¢	$consulta = $conexion->query("SELECT ...");
Ejecuta consulta SQL que obtiene todas las filas ordenadas por id descendente.
	‚Ä¢	<!DOCTYPE html>, <html lang="es">, <meta charset="UTF-8">
Declaran documento HTML5, idioma espa√±ol y codificaci√≥n UTF-8.
	‚Ä¢	<link rel="stylesheet" href="estilo.css">
Carga estilos externos.
	‚Ä¢	<?= htmlspecialchars($nombre_usuario) ?>
Inserta valor escapado para evitar inyecci√≥n de HTML en la salida. htmlspecialchars convierte caracteres especiales.
	‚Ä¢	<nav> ... </nav>
Barra de navegaci√≥n interna con enlaces de trabajo frecuente.
	‚Ä¢	<?php if ($consulta && $consulta->num_rows > 0): ?>
Condici√≥n que eval√∫a si la consulta fue exitosa y trajo al menos una fila.
	‚Ä¢	while ($fila = $consulta->fetch_assoc())
Bucle que extrae cada fila como arreglo asociativo con claves iguales a las columnas.
	‚Ä¢	<?= (int)$fila["id"] ?>
Conversi√≥n expl√≠cita a entero para imprimir el identificador.
	‚Ä¢	onclick="return confirm('¬øSeguro de eliminar?');"
Di√°logo de confirmaci√≥n del navegador; si el usuario cancela retorna false y el enlace no navega.

‚∏ª

Parte A ‚Äî C√≥digo limpio (salir.php)

<?php
session_start();

$_SESSION = [];
session_unset();
session_destroy();

header("Location: iniciar_sesion.php");
exit;

Parte B ‚Äî Explicaci√≥n l√≠nea por l√≠nea (salir.php)
	‚Ä¢	session_start();
Asegura que la sesi√≥n est√© disponible para poder destruirla.
	‚Ä¢	$_SESSION = [];
Vac√≠a el arreglo de variables de sesi√≥n en memoria.
	‚Ä¢	session_unset();
Limpia variables de sesi√≥n registradas.
	‚Ä¢	session_destroy();
Destruye el contenedor de la sesi√≥n en el servidor.
	‚Ä¢	header("Location: iniciar_sesion.php"); exit;
Redirige al formulario de inicio de sesi√≥n y corta la ejecuci√≥n.

‚∏ª

üéØ Pruebas r√°pidas
	1.	Entrar con usuario v√°lido en iniciar_sesion.php.
	2.	Abrir privado.php directamente: debe cargar sin redirigir.
	3.	Abrir salir.php: debe destruir la sesi√≥n y llevar a iniciar_sesion.php.
	4.	Intentar privado.php tras salir: debe redirigir a iniciar_sesion.php.
